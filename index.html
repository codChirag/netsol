<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShopEase - Purchase</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="logo">ShopEase</div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="deals.html">Deals</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="cart.html">Cart (<span id="cart-count">0</span>)</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <h1>Purchase Details</h1>
    <section id="cart-summary"></section>

    <h2>Shipping Information</h2>
    <form id="purchaseForm">
      <label for="fullName">Full Name:</label><br />
      <input type="text" id="fullName" name="fullName" required /><br />

      <label for="address">Address:</label><br />
      <textarea id="address" name="address" rows="3" required></textarea><br />

      <label for="city">City:</label><br />
      <input type="text" id="city" name="city" required /><br />

      <label for="state">State/Province:</label><br />
      <input type="text" id="state" name="state" required /><br />

      <label for="zip">Zip/Postal Code:</label><br />
      <input type="text" id="zip" name="zip" required /><br />

      <label for="country">Country:</label><br />
      <input type="text" id="country" name="country" required /><br />

      <button type="submit" class="btn-primary" style="margin-top: 1rem;">Proceed to Payment</button>
    </form>
  </main>

  <footer>
    <p>© 2024 ShopEase. All rights reserved.</p>
  </footer>

  <script src="products.js"></script>
  <script src="cart.js"></script>
  <script>
    const cartSummary = document.getElementById('cart-summary');

    function renderCartSummary() {
      const cart = getCart();
      if (cart.length === 0) {
        cartSummary.innerHTML = '<p>Your cart is empty. Please add products before purchasing.</p>';
        document.getElementById('purchaseForm').style.display = 'none';
        return;
      }

      let total = 0;
      let html = '<h2>Order Summary</h2><ul>';

      cart.forEach(({ id, quantity }) => {
        const product = productList.find(p => p.id === id);
        if (!product) return;

        const subtotal = product.price * quantity;
        total += subtotal;
        html += `<li>${product.name} × ${quantity} = $${subtotal.toFixed(2)}</li>`;
      });

      html += `</ul><p><strong>Total: $${total.toFixed(2)}</strong></p>`;
      cartSummary.innerHTML = html;
    }

    renderCartSummary();

    // Handle shipping info form submit
    document.getElementById('purchaseForm').addEventListener('submit', e => {
      e.preventDefault();

      // Collect shipping info
      const shippingInfo = {
        fullName: e.target.fullName.value.trim(),
        address: e.target.address.value.trim(),
        city: e.target.city.value.trim(),
        state: e.target.state.value.trim(),
        zip: e.target.zip.value.trim(),
        country: e.target.country.value.trim()
      };

      if (Object.values(shippingInfo).some(field => field === '')) {
        alert('Please fill in all shipping details.');
        return;
      }

      // Save shipping info to sessionStorage temporarily
      sessionStorage.setItem('shippingInfo', JSON.stringify(shippingInfo));

      // Redirect to payment page
      window.location.href = 'payment.html';
    });

    updateCartCount();
  </script>
</body>
</html>
