<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ShopEase - Payment</title>
  <link rel="stylesheet" href="styles.css" />
</head>
<body>
  <header>
    <div class="logo">ShopEase</div>
    <nav>
      <ul>
        <li><a href="index.html">Home</a></li>
        <li><a href="shop.html">Shop</a></li>
        <li><a href="deals.html">Deals</a></li>
        <li><a href="about.html">About</a></li>
        <li><a href="contact.html">Contact</a></li>
        <li><a href="cart.html">Cart (<span id="cart-count">0</span>)</a></li>
      </ul>
    </nav>
  </header>

  <main class="container">
    <h1>Payment</h1>
    <section id="order-details"></section>

    <form id="paymentForm">
      <label for="cardName">Name on Card:</label><br />
      <input type="text" id="cardName" name="cardName" required /><br />

      <label for="cardNumber">Card Number:</label><br />
      <input type="text" id="cardNumber" name="cardNumber" required pattern="[0-9\s]{13,19}" title="Enter numbers only" /><br />

      <label for="expiry">Expiry Date (MM/YY):</label><br />
      <input type="text" id="expiry" name="expiry" required pattern="(0[1-9]|1[0-2])\/?[0-9]{2}" title="MM/YY format" /><br />

      <label for="cvv">CVV:</label><br />
      <input type="text" id="cvv" name="cvv" required pattern="[0-9]{3,4}" title="3 or 4 digits CVV" /><br />

      <button type="submit" class="btn-primary" style="margin-top: 1rem;">Confirm Purchase</button>
    </form>

    <div id="confirmationMessage" style="display:none; margin-top:20px;"></div>
  </main>

  <footer>
    <p>© 2024 ShopEase. All rights reserved.</p>
  </footer>

  <script src="products.js"></script>
  <script src="cart.js"></script>
  <script>
    const orderDetailsEl = document.getElementById('order-details');
    const confirmationMessage = document.getElementById('confirmationMessage');
    const paymentForm = document.getElementById('paymentForm');

    function renderOrderDetails() {
      const cart = getCart();
      const shippingInfo = JSON.parse(sessionStorage.getItem('shippingInfo'));

      if (!shippingInfo) {
        alert('Please enter shipping info first.');
        window.location.href = 'purchase.html';
        return;
      }

      if (cart.length === 0) {
        orderDetailsEl.innerHTML = '<p>Your cart is empty. Please add products first.</p>';
        paymentForm.style.display = 'none';
        return;
      }

      let total = 0;
      let html = '<h2>Order Summary</h2><ul>';

      cart.forEach(({ id, quantity }) => {
        const product = productList.find(p => p.id === id);
        if (!product) return;

        const subtotal = product.price * quantity;
        total += subtotal;
        html += `<li>${product.name} × ${quantity} = $${subtotal.toFixed(2)}</li>`;
      });

      html += `</ul><p><strong>Total: $${total.toFixed(2)}</strong></p>`;

      html += '<h2>Shipping Information</h2><p>';
      html += `${shippingInfo.fullName}<br />`;
      html += `${shippingInfo.address}<br />`;
      html += `${shippingInfo.city}, ${shippingInfo.state} ${shippingInfo.zip}<br />`;
      html += `${shippingInfo.country}</p>`;

      orderDetailsEl.innerHTML = html;
    }

    renderOrderDetails();
    updateCartCount();

    paymentForm.addEventListener('submit', e => {
      e.preventDefault();
      // In real scenario, validate & process payment here
      // Simulate success:

      localStorage.removeItem('shopEaseCart');       // clear cart
      sessionStorage.removeItem('shippingInfo');     // clear shipping info
      updateCartCount();

      paymentForm.style.display = 'none';

      confirmationMessage.style.display = 'block';
      confirmationMessage.innerHTML =
        '<h2>Thank you for your purchase!</h2>' +
        '<p>Your order has been placed and will be processed shortly.</p>' +
        '<p><a href="index.html" class="btn-primary">Return to Home</a></p>';
    });

  </script>
</body>
</html>
